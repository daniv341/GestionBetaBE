generator client {
  provider = "prisma-client-js"
}

// npx prisma generate - genera el cliente prisma, debes usar el comando despues de aplicar una migracion
// npx prisma migrate dev -- name "nombre_de_la_migracion" - realiza la migracion de la base de datos y le pone el nombre que especifiques
// npx prisma migrate reset - borra la bd, esto es util para cuando hagas cambios en los cuales sea necesario borrar la bd para que se aplique, antes te pregunta si quieres hacerlo
// npx prisma migrate dev - asi como esta te dira si hay cambios que deban guardarse o el estado en el que se encuentra todo
// una migracion se refiere a un cambio que le hiciste a la estructura de la base de datos

// provider indica quien es el proveedor de la base de datos o del cliente(dependiendo para que lo uses)
// url indica la url para poder dirigirte a la base de datos, es esencial, sin ella no puede operar la bd

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// id indica que ese parametro sera el id de la tabla
// unique indica que el mismo debe ser unico o no puede repetirse
// default indica como sera dicho parametro por defecto
// autoincrement indica que dicho parametro sera autoincremental
// cuid es para indicar que el id sera un id unico
// ? indica que la relacion o el parametro es opcional, es decir puede ser nula o opcional mejor dicho
// relation indica que hay una relacion entre 2 tablas

//asi se agrega enum en prisma, lo resto esta en tabla Venta
enum MetodoPago {
  EFECTIVO
  DEBITO
  CREDITO
}

model Usuario{
  uid               String        @id @default(cuid())
  email             String        @unique
  nombre            String        
  contrase√±a        String?    
  enable            Boolean       @default(true)
  direccion         String?
  logo_negocio      String?
  nombre_negocio    String?
  fecha_creacion    DateTime      @default(now())

  productos         Producto[]
  compras           Compra[]
  proveedores       Proveedor[]
  ventas            Venta[]
}

model Producto{
  id                Int           @id @default(autoincrement())
  nombre            String
  descripcion       String
  precio_venta      Float
  precio_compra     Float
  categoria         String
  SKU               String?       @unique
  stock_actual      Int
  stock_minimo      Int
  enable            Boolean       @default(true)
  fecha_creacion    DateTime      @default(now())

  //relacion con usuario, indica que la clave foranea (usuarioId) se relacionara con la otra tabla (usuario) usando como referencia el id de la tabla padre (usuario)
  usuarioId         String?       
  usuario           Usuario?      @relation(fields: [usuarioId],references: [uid])

  //relacion con detalle venta
  detalles_venta    DetalleVenta[]
} 

//revisar, es una relacion de 1 a muchos
model Proveedor{
  id                Int           @id @default(autoincrement())
  empresa           String
  descripcion       String
  fecha_creacion    DateTime      @default(now())

  compras           Compra[]

  //relacion con usuario
  usuarioId         String?       
  usuario           Usuario?      @relation(fields: [usuarioId],references: [uid])

}

model Venta{
  id                Int           @unique @default(autoincrement())
  total             Float
  total_bruto       Float
  carga_impositiva  Float?
  estado            Boolean       @default(true)
  descuento         Float?
  fecha_creacion    DateTime      @default(now())
  fecha_carga       DateTime?
  metodo_pago       MetodoPago

  factura           Factura?

  //relacion con usuario
  usuarioId         String?      
  usuario           Usuario?      @relation(fields: [usuarioId],references: [uid])

  //relacion con detalle venta
  detalles_venta    DetalleVenta[]
}

model DetalleVenta{
  id                Int           @unique @default(autoincrement())
  subtotal          Float
  cantidad          Int
  nombre_producto   String

  //relacion con producto
  productoId        Int?
  producto          Producto?     @relation(fields: [productoId], references: [id])

  //relacion con producto
  ventaId           Int?
  venta             Venta?        @relation(fields: [ventaId], references: [id])

  //necesario para relacion muchos a muchos, sirve para unicidad(una fila no puede tener relacion con otra en otra tabla dos veces)
  @@unique([productoId, ventaId])
}

model Compra{
  uid               String        @id @default(cuid())
  total             Float
  total_bruto       Float
  carga_impositiva  Float?
  num_comprobante   Int           @unique
  estado            Boolean       @default(true)

  //relacion con usuario
  usuarioId         String?      
  usuario           Usuario?      @relation(fields: [usuarioId],references: [uid])
  
  //relacion con proveedor
  proveedorId       Int?          
  proveedor         Proveedor?    @relation(fields: [proveedorId],references: [id])
}

model Factura{
  id                Int           @id @default(autoincrement())
  ident_factura     Int           @unique
  fecha_emision     DateTime      @default(now())
  fecha_vencimiento DateTime?      

  //relacion con venta
  ventaId           Int?          @unique
  venta             Venta?        @relation(fields: [ventaId],references: [id])
}